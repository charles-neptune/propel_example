CLASS-METHODS get_for_approval
  IMPORTING
    i_status        TYPE char10 DEFAULT 'SUBMITTED'
    i_with_items    TYPE abap_bool DEFAULT abap_true
    i_with_sender   TYPE abap_bool DEFAULT abap_false
    i_with_periods  TYPE abap_bool DEFAULT abap_false
    i_with_text     TYPE abap_bool DEFAULT abap_false
    i_with_extin    TYPE abap_bool DEFAULT abap_false
  EXPORTING
    et_hdr          TYPE ztt_zfmbb_hdr
    et_item         TYPE ztt_zfmbb_item
    et_sitem        TYPE ztt_zfmbb_sitem
    et_prd          TYPE ztt_zfmbb_prd
    et_sprd         TYPE ztt_zfmbb_sprd
    et_ltxt         TYPE ztt_zfmbb_ltxt
    et_extin        TYPE ztt_zfmbb_extin.


METHOD get_for_approval.

  CLEAR: et_hdr, et_item, et_sitem, et_prd, et_sprd, et_ltxt, et_extin.

  "1) Headers awaiting approval
  SELECT *
    FROM zfmbb_hdr
    INTO TABLE @et_hdr
   WHERE status = @i_status
   ORDER BY erdat DESC, erzet DESC.

  IF et_hdr IS INITIAL.
    RETURN.
  ENDIF.

  "2) Optional child fetches (only when requested)
  IF i_with_items = abap_true.
    SELECT *
      FROM zfmbb_item
      INTO TABLE @et_item
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.
  ENDIF.

  IF i_with_sender = abap_true.
    SELECT *
      FROM zfmbb_sitem
      INTO TABLE @et_sitem
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.
  ENDIF.

  IF i_with_periods = abap_true.
    SELECT *
      FROM zfmbb_prd
      INTO TABLE @et_prd
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.

    SELECT *
      FROM zfmbb_sprd
      INTO TABLE @et_sprd
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.
  ENDIF.

  IF i_with_text = abap_true.
    SELECT *
      FROM zfmbb_ltxt
      INTO TABLE @et_ltxt
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.
  ENDIF.

  IF i_with_extin = abap_true.
    SELECT *
      FROM zfmbb_extin
      INTO TABLE @et_extin
      FOR ALL ENTRIES IN @et_hdr
     WHERE refid = @et_hdr-refid
     ORDER BY refid, seqno.
  ENDIF.

ENDMETHOD.



zcl_neptune_fmbb=>get_for_approval(
  EXPORTING
    i_status     = 'SUBMITTED'
    i_with_items = abap_false
  IMPORTING
    et_hdr       = lt_hdr
).
